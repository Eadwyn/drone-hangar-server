<!DOCTYPE html>
<html lang="cmn-Hans">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no, width=device-width" />
    <meta http-equiv="pragma" content="no-cache" />
    <meta http-equiv="cache-control" content="no-cache" />
    <meta http-equiv="expires" content="0" />
    <title>无人机巡检系统</title>
    <!-- <link rel="icon" href="../favicon.ico">-->
    <!--<link rel="stylesheet" href="../resources/modules/bootstrap/css/bootstrap.min.css">-->
    <link href="./resources/modules/videojs/video-js.min.css" rel="stylesheet" />
    <style type="text/css">
        html,
        body,
        #container {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
            font-size: 16px;
            color: #ffffff;
        }

        #container {
            position: absolute;
            left: 0px;
            top: 0px;
        }

        #header {
            position: absolute;
            left: 0px;
            top: 0px;
            width: 100%;
            height: 40px;
            background-color: #0c7684;
            z-index: 1000;
        }

        #valueContainer {
            position: absolute;
            left: 5px;
            top: 0px;
            width: 180px;
            min-height: 200px;
            max-height: calc(100% - 60px);
            background-color: #3d4243;
            margin-top: 50px;
            margin-bottom: 10px;
            padding: 10px;
            opacity: 0.8;
            overflow: auto;
            z-index: 1000;
        }

        #controllContainer {
            position: absolute;
            right: 5px;
            top: 0px;
            width: 80px;
            min-height: 200px;
            max-height: calc(100% - 60px);
            background-color: #3d4243;
            margin-top: 50px;
            margin-bottom: 10px;
            padding: 10px;
            padding-top: 5px;
            opacity: 0.9;
            overflow: auto;
            z-index: 1000;
        }

        #logContainer {
            position: absolute;
            bottom: 5px;
            left: 50%;
            margin-left: -250px;
            width: 500px;
            height: 100px;
            background-color: #e5e5e5;
            border-radius: 10px;
            opacity: 0.8;
            overflow: auto;
            padding: 10px;
            padding-left: 20px;
            color: rgb(255, 0, 255);
            font-size: 12px;
            z-index: 1000;
        }

        #videoContainer {
            position: absolute;
            right: 120px;
            top: 55px;
            width: 576px;
            height: 324px;
            z-index: 1000;
        }

        #videoContainer #video-player {
            width: 100%;
            height: 100%;
        }

        #logContainer ul,
        #logContainer ul li {
            padding: 0;
            margin: 0;
            list-style: none;
        }

        #btnLogin {
            background-color: #032d33;
            padding: 3px 10px;
            border: 0;
            color: #ffffff;
        }

        .controllBtn {
            width: 100%;
            display: block;
            margin-top: 5px;
            background-color: #0c7684;
            color: #ffffff;
            opacity: 1;
        }

        .valuePanel {
            font-size: 12px;
        }
    </style>
</head>

<body>
    <div id="container"></div>
    <div id="header">
        <div style="
          display: inline-block;
          float: left;
          font-size: 24px;
          line-height: 40px;
          padding-left: 5px;
        ">
            朱雀智能停机坪系统
        </div>
        <div style="
          position: absolute;
          top: 0;
          left: 0;
          margin-left: 50%;
          display: inline-block;
          clear: both;
          line-height: 40px;
        ">
            <span class="connection_status">未连接</span>
        </div>
        <div style="
          display: inline-block;
          float: right;
          line-height: 40px;
          padding-right: 5px;
        ">
            账号:
            <input type="text" id="username" name="username" maxlength="6" style="width: 80px;" />
            密码:
            <input type="password" id="password" name="password" maxlength="6" style="width: 80px;" />
            <button type="button" id="btnLogin">登录</button>
        </div>
    </div>
    <div id="valueContainer">
        <div class="valuePanel">
            停机枰经度：<span id="hangarLongitudeValue">未知</span>deg
        </div>
        <div class="valuePanel">
            停机枰纬度：<span id="hangarLatitudeValue">未知</span>deg
        </div>
        <div class="valuePanel">
            卫星数：<span id="satelliteValue">未知</span>
        </div>
        <div class="valuePanel">
            风速：<span id="windSpeedValue">未知</span>m/s
        </div>
        <div class="valuePanel">
            风向：<span id="windDirectionValue">未知</span>deg
        </div>
        <div class="valuePanel">
            温度：<span id="temperatureValue">未知</span>℃
        </div>
        <div class="valuePanel">湿度：<span id="humidityValue">未知</span>%</div>
        <div class="valuePanel">光照：<span id="lightValue">未知</span>lux</div>
        <div class="valuePanel">雨量：<span id="rainValue">未知</span></div>
        <div class="valuePanel">舱盖：<span id="coverValue">未知</span></div>
        <div class="valuePanel">回中器：<span id="folderValue">未知</span></div>
        <div class="valuePanel">起降台：<span id="liftsValue">未知</span></div>
        <div class="valuePanel">内部灯：<span id="inLampValue">未知</span></div>
        <div class="valuePanel">外部灯：<span id="outLampValue">未知</span></div>
        <div class="valuePanel">
            机坪电源：<span id="hangarPowerValue">未知</span>
        </div>
        <div class="valuePanel">
            充电电源：<span id="chargerPowerValue">未知</span>
        </div>
        <div class="valuePanel">
            射频电源：<span id="rfPowerValue">未知</span>
        </div>
        <div class="valuePanel">
            摄像头电源：<span id="cameraPowerValue">未知</span>
        </div>
        <div class="valuePanel">
            遥控电源：<span id="remotePowerValue">未知</span>
        </div>
        <div class="valuePanel">
            基站电源：<span id="rtkPowerValue">未知</span>
        </div>
        <div class="valuePanel">
            显示电源：<span id="screenPowerValue">未知</span>
        </div>
        <div class="valuePanel">
            话器电源：<span id="speakerPowerValue">未知</span>
        </div>
        <div class="valuePanel">
            伺服电源：<span id="driverPowerValue">未知</span>
        </div>
        <div class="valuePanel">信号强度：<span id="rssiValue">未知</span></div>
        <div class="valuePanel">横滚：<span id="rollValue">未知</span>deg</div>
        <div class="valuePanel">俯仰：<span id="pitchValue">未知</span>deg</div>
        <div class="valuePanel">航向：<span id="yawValue">未知</span>deg</div>
        <div class="valuePanel">起飞高度：<span id="hightValue">未知</span>m</div>
        <div class="valuePanel">
            飞行距离：<span id="distanceValue">未知</span>m
        </div>
        <div class="valuePanel">
            东向速度：<span id="eastSpeedValue">未知</span>deg
        </div>
        <div class="valuePanel">
            北向速度：<span id="northSpeedValue">未知</span>deg
        </div>
        <div class="valuePanel">
            垂直速度：<span id="upSpeedValue">未知</span>deg
        </div>
        <div class="valuePanel">
            定位模式：<span id="fixTypeValue">未知</span>
        </div>
        <div class="valuePanel">电压：<span id="voltageValue">未知</span>V</div>
        <div class="valuePanel">电流：<span id="currentValue">未知</span>A</div>
        <div class="valuePanel">
            电压百分比：<span id="percentageValue">未知</span>%
        </div>
        <div class="valuePanel">
            云台航向：<span id="gimbalYawValue">未知</span>deg
        </div>
        <div class="valuePanel">
            云台俯仰：<span id="gimbalPitchValue">未知</span>deg
        </div>
        <div class="valuePanel">
            相机焦距：<span id="cameraFoceValue">未知</span>
        </div>
        <div class="valuePanel">
            相机状态：<span id="cameraStatusValue">未知</span>
        </div>
        <div class="valuePanel">
            飞行模式：<span id="flightModeValue">未知</span>
        </div>
        <div class="valuePanel">
            RTK连接状态：<span id="rtkConnectedValue">未知</span>
        </div>
        <div class="valuePanel">马达状态：<span id="motorsValue">未知</span></div>
        <div class="valuePanel">
            航点就绪：<span id="wayPointReadyValue">未知</span>
        </div>
        <div class="valuePanel">
            充电状态：<span id="beingChargedValue">未知</span>
        </div>
    </div>
    <div id="controllContainer">
        <div>
            <select id="wayPoint">
                <option value="-1">选择航线</option>
                <option value="1">1号航线</option>
                <option value="2">2号航线</option>
                <option value="3">3号航线</option>
            </select>
        </div>
        <button id="btnLoadWaypoint" class="controllBtn">加载航线</button>
        <button id="btnTakeOff" class="controllBtn">起飞</button>
        <button id="btnLanding" class="controllBtn">降落</button>
        <button id="btnReturn" class="controllBtn">返航</button>
        <button id="btnPause" class="controllBtn">暂停航线</button>
        <button id="btnResume" class="controllBtn">恢复航线</button>
        <button id="btnAuto" class="controllBtn">自动航线</button>
        <button id="btnCharger" class="controllBtn">自动充电</button>
        <button id="btnHangarStart" class="controllBtn">准备起飞</button>
        <button id="btnHangerStop" class="controllBtn">停止流程</button>
        <button id="btnHangarSleep" class="controllBtn">休眠流程</button>
    </div>
    <div id="logContainer">
        <ul></ul>
    </div>
    <div id="videoContainer">
        <video id="video-player" class="video-js" muted webkit-playsinline preload="auto" data-setup="{}">
            <source src="http://112.74.216.37:8080/hls/hangar2-gimbal-video.m3u8" type="application/vnd.apple.mpegurl" />
            <p class="warning">该浏览器不支持视频HTML5播放</p>
        </video>
    </div>
    <script src="./resources/modules/jquery/jquery-3.5.1.min.js"></script>
    <script src="./resources/Ajax.js"></script>
    <script src="https://webapi.amap.com/loader.js"></script>
    <script src="./resources/modules/videojs/video.min.js"></script>
    <script type="text/javascript">
        var options = {};
        var player = videojs("video-player", options, function onPlayerReady() {
            this.play();
        });
    </script>
    <script type="text/javascript">
        var map;
        var markers = [];
        var polylines = [];
        AMapLoader.load({
                key: "e9033faeecc84dcbc08e0ef3b5819b57",
                version: "2.0",
                plugins: ["AMap.Scale"],
            })
            .then((AMap) => {
                map = new AMap.Map("container", {
                    zoom: 16,
                    center: [113.5975887, 22.7541939],
                    layers: [
                        new AMap.TileLayer.Satellite(),
                        new AMap.TileLayer.RoadNet(),
                    ],
                });
                map.addControl(new AMap.Scale());
            })
            .catch((e) => {
                console.error(e);
            });
    </script>
    <script type="text/javascript">
        function refreshWeatherData(weatherData) {
            $("#hangarLongitudeValue").html(weatherData.longitude);
            $("#hangarLatitudeValue").html(weatherData.latitude);
            $("#satelliteValue").html(weatherData.satellite);
            $("#windSpeedValue").html(weatherData.windSpeed);
            $("#windDirectionValue").html(weatherData.windDirection);
            $("#temperatureValue").html(weatherData.temperature);
            $("#humidityValue").html(weatherData.humidity);
            $("#lightValue").html(weatherData.light);
            $("#rainValue").html(weatherData.rain);
        }

        function refreshHangarData(hangarData) {
            switch (hangarData.cover) {
                case 1:
                    $("#coverValue").html("关闭");
                    break;
                case 2:
                    $("#coverValue").html("打开");
                    break;
                case 3:
                    $("#coverValue").html("正在关闭");
                    break;
                case 4:
                    $("#coverValue").html("正在打开");
                    break;
                default:
                    $("#coverValue").html("未知");
            }
            switch (hangarData.folder) {
                case 1:
                    $("#folderValue").html("夹紧");
                    break;
                case 2:
                    $("#folderValue").html("放松");
                    break;
                case 3:
                    $("#folderValue").html("运动过程");
                    break;
                default:
                    $("#folderValue").html("未知");
            }
            switch (hangarData.lifts) {
                case 1:
                    $("#liftsValue").html("降下");
                    break;
                case 2:
                    $("#liftsValue").html("升起");
                    break;
                case 3:
                    $("#liftsValue").html("降下过程");
                    break;
                case 4:
                    $("#liftsValue").html("升起过程");
                    break;
                default:
                    $("#liftsValue").html("未知");
            }
            var setValueStatus = function (obj, status) {
                if (status) {
                    obj.html("打开");
                } else {
                    obj.html("关闭");
                }
            };
            setValueStatus($("#inLampValue"), hangarData.inLamp);
            setValueStatus($("#outLampValue"), hangarData.outLamp);
            setValueStatus($("#hangarPowerValue"), hangarData.hangarPower);
            setValueStatus($("#chargerPowerValue"), hangarData.chargerPower);
            setValueStatus($("#rfPowerValue"), hangarData.rfPower);
            setValueStatus($("#cameraPowerValue"), hangarData.cameraPower);
            setValueStatus($("#remotePowerValue"), hangarData.remotePower);
            setValueStatus($("#rtkPowerValue"), hangarData.rtkPower);
            setValueStatus($("#screenPowerValue"), hangarData.screenPower);
            setValueStatus($("#speakerPowerValue"), hangarData.speakerPower);
            setValueStatus($("#driverPowerValue"), hangarData.driverPower);
        }

        function setFlightMode(mode) {
            switch (mode) {
                case 0:
                    $("#flightModeValue").html("MANUAL");
                    break;
                case 1:
                    $("#flightModeValue").html("ATTI");
                    break;
                case 2:
                    $("#flightModeValue").html("ATTI_COURSE_LOCK");
                    break;
                case 3:
                    $("#flightModeValue").html("ATTI_HOVER");
                    break;
                case 4:
                    $("#flightModeValue").html("HOVER");
                    break;
                case 5:
                    $("#flightModeValue").html("GPS_BLAKE");
                    break;
                case 6:
                    $("#flightModeValue").html("GPS_ATTI");
                    break;
                case 7:
                    $("#flightModeValue").html("GPS_COURSE_LOCK");
                    break;
                case 8:
                    $("#flightModeValue").html("GPS_HOME_LOCK");
                    break;
                case 9:
                    $("#flightModeValue").html("GPS_HOT_POINT");
                    break;
                case 10:
                    $("#flightModeValue").html("ASSISTED_TAKEOFF");
                    break;
                case 11:
                    $("#flightModeValue").html("AUTO_TAKEOFF");
                    break;
                case 12:
                    $("#flightModeValue").html("AUTO_LANDING");
                    break;
                case 13:
                    $("#flightModeValue").html("ATTI_LANDING");
                    break;
                case 14:
                    $("#flightModeValue").html("GPS_WAYPOINT");
                    break;
                case 15:
                    $("#flightModeValue").html("GO_HOME");
                    break;
                case 16:
                    $("#flightModeValue").html("CLICK_GO");
                    break;
                case 17:
                    $("#flightModeValue").html("JOYSTICK");
                    break;
                case 18:
                    $("#flightModeValue").html("GPS_ATTI_WRISTBAND");
                    break;
                case 19:
                    $("#flightModeValue").html("CINEMATIC");
                    break;
                case 23:
                    $("#flightModeValue").html("ATTI_LIMITED");
                    break;
                case 24:
                    $("#flightModeValue").html("DRAW");
                    break;
                case 25:
                    $("#flightModeValue").html("GPS_FOLLOW_ME");
                    break;
                case 26:
                    $("#flightModeValue").html("ACTIVE_TRACK");
                    break;
                case 27:
                    $("#flightModeValue").html("TAP_FLY");
                    break;
                case 28:
                    $("#flightModeValue").html("PANO");
                    break;
                case 29:
                    $("#flightModeValue").html("FARMING");
                    break;
                case 30:
                    $("#flightModeValue").html("FPV");
                    break;
                case 31:
                    $("#flightModeValue").html("GPS_SPORT");
                    break;
                case 32:
                    $("#flightModeValue").html("GPS_NOVICE");
                    break;
                case 33:
                    $("#flightModeValue").html("CONFIRM_LANDING");
                    break;
                case 35:
                    $("#flightModeValue").html("TERRAIN_FOLLOW");
                    break;
                case 36:
                    $("#flightModeValue").html("PALM_CONTROL");
                    break;
                case 37:
                    $("#flightModeValue").html("QUICK_SHOT");
                    break;
                case 38:
                    $("#flightModeValue").html("TRIPOD");
                    break;
                case 39:
                    $("#flightModeValue").html("TRACK_SPOTLIGHT");
                    break;
                case 41:
                    $("#flightModeValue").html("MOTORS_JUST_STARTED");
                    break;
                case 43:
                    $("#flightModeValue").html("DETOUR");
                    break;
                case 46:
                    $("#flightModeValue").html("TIME_LAPSE");
                    break;
                case 50:
                    $("#flightModeValue").html("POI2");
                    break;
                case 49:
                    $("#flightModeValue").html("OMNI_MOVING");
                    break;
                case 41:
                    $("#flightModeValue").html("ADSB_AVOIDING");
                    break;
                case 255:
                default:
                    $("#flightModeValue").html("未知");
            }
        }

        function refreshFlightData(flightData) {
            $("#rssiValue").html(flightData.rssi);
            $("#rollValue").html(flightData.roll);
            $("#pitchValue").html(flightData.pitch);
            $("#yawValue").html(flightData.yaw);
            $("#hightValue").html(flightData.hight);
            $("#distanceValue").html(flightData.distance);
            $("#eastSpeedValue").html(flightData.eastSpeed);
            $("#northSpeedValue").html(flightData.northSpeed);
            $("#upSpeedValue").html(flightData.upSpeed);
            $("#fixTypeValue").html(flightData.fixType);
            $("#voltageValue").html(flightData.voltage);
            $("#currentValue").html(flightData.current);
            $("#percentageValue").html(flightData.percentage);
            $("#gimbalYawValue").html(flightData.gimbalYaw);
            $("#gimbalPitchValue").html(flightData.gimbalPitch);
            $("#xxxxxxcameraFoceValuexx").html(flightData.cameraFoce);
            $("#cameraStatusValue").html(flightData.cameraStatus);
            setFlightMode(flightData.flightMode);
            $("#rtkConnectedValue").html(flightData.rtkConnected);
            $("#motorsValue").html(flightData.motors);
            $("#wayPointReadyValue").html(flightData.wayPointReady);
            $("#beingChargedValue").html(flightData.beingCharged);
            setPosition(flightData.longitude, flightData.latitude);
        }

        function refreshTextData(textData) {
            var logPanel = $("#logContainer ul");
            for (var i = 0, len = textData.length; i < len; i++) {
                logPanel.html(logPanel.html() + "<li>[" + textData[i].time + "] " + textData[i].text + "</li>");
            }
            $("#logContainer").scrollTop($("#logContainer").prop('scrollHeight'));
        }

        function refreshWayPointData(wayPointData) {
            if (!map || !wayPointData || wayPointData.length == 0) {
                return;
            }
            if (polylines) {
                map.remove(polylines);
            }
            polylines.length = 0;
            var path = [];
            for (var i = 0, len = wayPointData.length; i < len; i++) {
                path.push([wayPointData.longitude, wayPointData.latitude]);
            }
            var line = new AMap.Polyline({
                path: path,
                isOutline: true,
                outlineColor: "#FF0000",
                borderWeight: 3,
                strokeColor: "#FF0000",
                strokeOpacity: 1,
                strokeWeight: 3,
                strokeStyle: "solid",
                strokeDasharray: [10, 5],
                lineJoin: "round",
                lineCap: "round",
                zIndex: 50,
            });
            polylines.push(line);
            map.add(polylines);
            map.setFitView();
        }

        function refreshData() {
            Ajax.post("/data/getAll", {}, function (response) {
                if (response.code == "0") {
                    refreshWeatherData(response.data.weatherData);
                    refreshHangarData(response.data.hangarData);
                    refreshFlightData(response.data.flightData);
                    refreshTextData(response.data.textData);
                    refreshWayPointData(response.data.wayPointData);
                } else {
                    alert(response.message);
                }
            });
        }
        window.setInterval(function () {
            refreshData();
        }, 1000);
    </script>
    <script type="text/javascript">
        function setPosition(lon, lat) {
            if (!map) {
                return;
            }
            var icon = new AMap.Icon({
                size: new AMap.Size(36, 36),
                image: "./resources/images/aircraft.png",
                imageOffset: new AMap.Pixel(0, 0),
                imageSize: new AMap.Size(36, 36),
            });
            var marker = new AMap.Marker({
                position: new AMap.LngLat(lon, lat),
                offset: new AMap.Pixel(-10, -10),
                icon: icon,
            });
            map.remove(markers);
            markers.length = 0;
            markers.push(marker);
            map.add(marker);
        }
    </script>
    <script type="text/javascript">
        function login() {
            if ($("#username").val().length != 6) {
                alert("账号应为长度为6的字符");
                return;
            }
            if ($("#password").val().length != 6) {
                alert("密码应为长度为6的字符");
                return;
            }
            Ajax.post(
                "/login", {
                    username: $("#username").val(),
                    password: $("#password").val(),
                },
                function (response) {
                    if (response.code == "0") {
                        $("#header .connection_status").html("已连接");
                    } else {
                        $("#header .connection_status").html("未连接");
                        alert(response.message);
                    }
                }
            );
        }

        function loadWayPoint() {
            Ajax.post(
                "/aircrafts/loadWayPoint", {
                    code: $("#wayPoint").val(),
                },
                function (response) {
                    if (response.code == "0") {} else {
                        alert(response.message);
                    }
                }
            );
        }

        function takeOff() {
            Ajax.post("/aircrafts/takeOff", {});
        }

        function landing() {
            Ajax.post("/aircrafts/landing", {});
        }

        function returnHome() {
            Ajax.post("/aircrafts/returnHone", {});
        }

        function pause() {
            Ajax.post("/aircrafts/pause", {});
        }

        function resume() {
            Ajax.post("/aircrafts/resume", {});
        }

        function auto() {
            Ajax.post("/aircrafts/auto", {});
        }

        function charger() {
            Ajax.post("/aircrafts/charger", {});
        }

        function hangarStart() {
            Ajax.post("/aircrafts/hangarStart", {});
        }

        function hangerStop() {
            Ajax.post("/aircrafts/hangerStop", {});
        }

        function hangarSleep() {
            Ajax.post("/aircrafts/hangarSleep", {});
        }
        $(function () {
            $("#btnLogin").bind("click", login);
            $("#wayPoint").bind("change", loadWayPoint);
            $("#btnTakeOff").bind("click", takeOff);
            $("#btnLanding").bind("click", landing);
            $("#btnReturn").bind("click", returnHome);
            $("#btnPause").bind("click", pause);
            $("#btnResume").bind("click", resume);
            $("#btnAuto").bind("click", auto);
            $("#btnCharger").bind("click", charger);
            $("#btnHangarStart").bind("click", hangarStart);
            $("#btnHangerStop").bind("click", hangerStop);
            $("#btnHangarSleep").bind("click", hangarSleep);
        });
    </script>
</body>

</html>